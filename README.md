# Excel 字段提取 - 沈浪制作 v0.3.4

版本: v0.3.4  
变更记录:
- v0.3.4 (2025-08-22): 统一高度锁定为 CSS 变量 `--panel-fixed-h`；原始表头键盘事件改为 `keydown` 支持 Enter/Space；预览表格 th/td 增加 `title` 提示；细化可访问性与动效降级
- v0.3.3 (2025-08-22): 恢复第二区域高度锁定逻辑，避免导入后高度跳变
- v0.3.2 (2025-08-22): 移除“表头选择”按钮相关引用，消除空引用风险
- v0.3.1 (2025-08-22): 面板滚动策略调整为“左右列表各自滚动”，保持输入与按钮稳定可见
- v0.3.0 (2025-08-22): 新增“输入列名”联想下拉（包含匹配），支持上下键、回车选择、鼠标点击
- v0.2.4 (2025-08-22): 新增“说明”模态（打开/关闭、遮罩点击、Esc 关闭）
- v0.2.3 (2025-08-21): 预览刷新由直接调用改为合帧调度 `requestAnimationFrame`
- v0.2.2 (2025-08-21): 释放内存与加载优化：导出仅依赖 headers/data；解析后立即重建索引缓存
- v0.2.1 (2025-08-21): 事件委托替代逐项监听，解析后立即构建索引缓存
- v0.2.0 (2025-08-21): 性能优化：批量 DOM 插入、拖拽后不重渲染、索引缓存
- v0.1.5 (2025-08-21): 切换第三方依赖为本地 `libs/` 引用；完善 README；统一首屏加载优化
- v0.1.4 (2025-08-21): 外部脚本 `defer`，避免阻塞首屏渲染
- v0.1.3 (2025-08-21): 新增数据预览（前 5 行）
- v0.1.2 (2025-08-21): 自动解析，移除“解析”按钮
- v0.1.0 (2025-08-21): 初始版本

---

## 项目简介
一个轻量级纯前端工具，支持从 Excel 工作簿中按列名挑选并导出新表。无需后端，双击打开即可使用，支持拖拽排序、历史配置与数据预览。

## 功能特性
- 选择列名并导出为新 Sheet（保持顺序）
- 从“原始表头”点击或键盘 Enter/Space 快速添加；“已选择列”支持拖拽排序、单项删除
- “输入列名”支持联想下拉（包含匹配），上下键导航、回车选择、鼠标点击
- 自动保存历史配置，快速复用
- 预览前 5 行，所见即所得；预览 th/td 悬停显示完整文本（`title`）
- UI 稳定：面板高度由 CSS 变量 `--panel-fixed-h` + `clamp()` 控制；左右列表独立垂直滚动
- 可访问性：键盘友好（Enter/Space）、ARIA 标签细化、`prefers-reduced-motion` 动效降级
- 跨浏览器滚动条样式：补充 Firefox（`scrollbar-width/scrollbar-color`）与 WebKit 方案
- 性能优化：批量 DOM 插入、rAF 合并渲染、索引缓存、事件委托
- 可离线使用：第三方库改为本地 `libs/` 引用

## 快速开始
- 直接双击 `index.html` 打开
- 点击“上传 Excel 文件 (.xlsx)”选择文件（将自动解析）
- 通过以下任一方式选择字段：
  - 在“原始表头”列表中直接点击列名
  - 在“输入列名”中输入多个列名（逗号/换行/空格分隔），点击“添加”或回车
  - 在“已选择列”中拖拽排序，点击“×”删除单项
- 预览区将展示所选列的前 5 行
- 填写新 sheet 名称（可选，默认“字段提取”），点击“导出处理后的文件”

## 键鼠与交互
- 原始表头：点击或键盘 Enter/Space 添加
- 已选择列：拖拽进行排序；点击“×”删除
- 历史配置：从下拉选择并“应用”；导出成功会自动保存当前选择

## 本地依赖
为保证离线可用与加载稳定，第三方库以本地文件形式提供：
- `./libs/xlsx.full.min.js`（SheetJS v0.18.5）
- `./libs/Sortable.min.js`（SortableJS v1.15.2）

## 性能优化说明
- 使用 `DocumentFragment` 批量插入列表与预览表格，减少回流/重绘
- 拖拽后根据 DOM 顺序同步 `state.selected`，避免整列表重渲染
- 缓存表头索引与所选列索引（`headerIndexMap`、`selectedIdx`）
- 使用 `requestAnimationFrame` 合并多次预览刷新请求
- 事件委托：在容器上统一监听点击/键盘/删除，减少监听器数量
 - 面板高度以 CSS 变量统一控制，避免 JS 内联高度与自适应策略冲突
 - 滚动条样式跨浏览器统一（Firefox/WebKit）

## 可访问性与稳定性
- 键盘：原始表头支持 Enter/Space 添加；输入框联想支持上下键与回车
- 视觉：小图标禁用抖动型 hover 动画；尊重 `prefers-reduced-motion`
- 可读性：预览表格与列表项均提供 `title`，查看被省略的长文本

## 目录结构
```
├─ index.html         # 页面结构与依赖引入
├─ styles.css         # 主题与布局样式
├─ main.js            # 业务逻辑与事件绑定
├─ libs/              # 第三方依赖（本地）
│  ├─ xlsx.full.min.js
│  └─ Sortable.min.js
└─ README.md          # 说明文档（当前）
```

## 兼容性
- 现代浏览器（Chrome/Edge 近两年版本）。建议使用 64 位浏览器处理较大工作簿。

## 开发与构建
- 纯静态站点，无需 Node/构建工具。若需要部署到静态托管（GitHub Pages、Netlify 等），直接发布整个目录即可。
- 建议：
  - 大数据集可引入预览虚拟化（仅渲染可视行）
  - 为 CDN 提供回退机制（本地失败→CDN）或反之
  - 生产部署可加上资源指纹与缓存策略

## 致谢
- [SheetJS](https://github.com/SheetJS/sheetjs)
- [SortableJS](https://github.com/SortableJS/Sortable)
